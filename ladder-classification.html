<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø³Ù„Ù… ÙˆØ§Ù„ØªØµÙ†ÙŠÙ â€“ MaktabaPlay (Ù…Ø­Ø³Ù‘Ù†)</title>
    <!-- Ø§Ù„Ø®Ø·ÙˆØ· -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;800&display=swap" rel="stylesheet">
    <!-- Ù…Ù„Ù Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…ÙˆØ­Ø¯ (Ø§ÙØªØ±Ø§Ø¶ÙŠ) -->
    <link rel="stylesheet" href="assets/style.css">
    <style>
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¹Ø¨Ø© (Ù…Ø­Ø³Ù‘Ù†Ø©) */
        .snl-board {
            width: min(78vmin, 760px);
            height: min(78vmin, 760px);
            margin: 0 auto;
            position: relative;
        }

        .snl-board-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 18px;
            display: block;
        }

        .snl-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            border-radius: 18px;
        }

        .snl-player {
            position: absolute;
            width: calc(min(78vmin, 760px) / 10 * 0.78);
            height: calc(min(78vmin, 760px) / 10 * 0.78);
            font-size: clamp(18px, 2.2vmin, 28px);
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            box-shadow: 0 6px 18px rgba(2, 6, 23, 0.8);
            transform: translate(-50%, -50%);
            transition: left 0.35s ease, top 0.35s ease;
            z-index: 20;
            pointer-events: none;
            color: #ffd966;
            font-weight: 800;
            text-shadow: 0 2px 5px black;
        }

        .snl-dice {
            font-size: 32px;
            padding: 15px;
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            border: 1px solid var(--border);
            color: var(--brand-2);
            font-weight: 800;
        }

        .snl-question-panel {
            background: #0b1220;
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
        }

        .snl-answer-btn {
            width: 100%;
            padding: 12px;
            margin: 6px 0;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            cursor: pointer;
            transition: 0.2s;
            text-align: right;
            font-size: 16px;
        }

        .snl-answer-btn:hover:not(:disabled) {
            background: rgba(6, 182, 212, 0.1);
            border-color: var(--brand-2);
        }

        .snl-answer-btn.correct {
            background: rgba(34, 197, 94, 0.1);
            border-color: var(--success);
            color: var(--success);
        }

        .snl-answer-btn.wrong {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--danger);
            color: var(--danger);
        }

        .snl-answer-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .snl-timer {
            color: var(--muted);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            align-items: center;
            font-weight: 600;
            margin-top: 15px;
        }

        .snl-log {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 10px;
            font-size: 13px;
            color: #94a3b8;
        }

        .snl-log div {
            padding: 6px 8px;
            border-bottom: 1px solid var(--border);
        }

        .control-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1 1 auto;
        }

        @media (max-width: 768px) {
            .snl-game-container {
                flex-direction: column;
                align-items: center;
            }

            .snl-controls {
                width: 100%;
            }
        }
    </style>
</head>

<body class="snl-page">
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù…ÙˆØ­Ø¯ -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="brand">
                <div class="brand-badge">Ù…Ù€</div>
                <span>MaktabaPlay</span>
            </div>
            <div class="nav-links">
                <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="hangman.html">Ù‡Ø§Ù†Ø¬ Ù…Ø§Ù† Ø§Ù„Ù…Ø®Ø·ÙˆØ·</a>
                <a href="ladder-classification.html" class="active">Ø§Ù„Ø³Ù„Ù… ÙˆØ§Ù„ØªØµÙ†ÙŠÙ</a>
                <a href="book-detective.html">Ù…Ø­Ù‚Ù‚ Ø§Ù„ÙƒØªØ¨</a>
                <a href="about.html">Ù…Ù† Ù†Ø­Ù†</a>
                <a href="contact.html">ØªÙˆØ§ØµÙ„</a>
                <a href="partners.html">Ø´Ø±ÙƒØ§Ø¡</a>
            </div>
        </div>
    </nav>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <section class="container">
        <div class="snl-game-container"
            style="display: flex; gap: 24px; align-items: flex-start; justify-content: center; flex-wrap: wrap;">
            <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
            <div class="snl-board" id="board">
                <img class="snl-board-image" id="boardImage" src="snake.jpg" alt="Ù„ÙˆØ­Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©">
                <canvas id="overlayCanvas" class="snl-overlay"></canvas>
                <div id="player" class="snl-player">ğŸ“</div>
            </div>

            <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
            <aside class="snl-controls" style="width: 360px; display: flex; flex-direction: column; gap: 16px;">
                <div class="snl-panel" style="display: flex; justify-content: space-between;">
                    <div>Ø§Ù„Ù…Ø±Ø¨Ø¹: <strong id="pos">1</strong></div>
                    <div>Ø§Ù„Ø­Ø§Ù„Ø©: <strong id="state">Ø¬Ø§Ù‡Ø²</strong></div>
                </div>

                <div class="control-buttons">
                    <button id="rollBtn" class="btn">ğŸ² Ø±Ù…ÙŠØ© Ø§Ù„Ù†Ø±Ø¯</button>
                    <button id="resetBtn" class="btn">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ø¯Ø¡</button>
                </div>
                <div class="snl-dice" id="diceResult">-</div>

                <div id="questionPanel" class="snl-question-panel" hidden>
                    <div id="questionText" class="snl-question-text" style="font-weight:600; margin-bottom:12px;"></div>
                    <div id="answers" class="snl-answers"></div>
                    <div class="snl-timer">Ø§Ù„ÙˆÙ‚Øª: <span id="qTimer">30</span> Ø«</div>
                </div>

                <div class="snl-log" id="log"></div>
            </aside>
        </div>
    </section>

    <!-- Ø§Ù„ÙÙˆØªØ± Ø§Ù„Ù…ÙˆØ­Ø¯ -->
    <footer>
        <div class="footer-inner">
            <div>Â© 2026 MaktabaPlay â€“ Ù…Ù†ØµØ© Ø£Ù„Ø¹Ø§Ø¨ Ù…ÙƒØªØ¨ÙŠØ© Ø¹Ø±Ø¨ÙŠØ©</div>
            <div><a href="contact.html">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a> Â· <a href="partners.html">Ø´Ø±Ø§ÙƒØ§Øª</a></div>
        </div>
    </footer>

    <script>
        // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø© (Ø¨Ø¯ÙˆÙ† Ø±Ø³ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©) =====
        const COLS = 10, ROWS = 10, N = COLS * ROWS;
        const QUESTION_TIME = 30;

        // Ø¹Ù†Ø§ØµØ± DOM
        const boardEl = document.getElementById('board');
        const overlayCanvas = document.getElementById('overlayCanvas');
        const boardImage = document.getElementById('boardImage');
        const playerEl = document.getElementById('player');
        const rollBtn = document.getElementById('rollBtn');
        const resetBtn = document.getElementById('resetBtn');
        const diceResult = document.getElementById('diceResult');
        const questionPanel = document.getElementById('questionPanel');
        const questionText = document.getElementById('questionText');
        const answersEl = document.getElementById('answers');
        const qTimerEl = document.getElementById('qTimer');
        const posEl = document.getElementById('pos');
        const stateEl = document.getElementById('state');
        const logEl = document.getElementById('log');

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø© (Ø³Ù„Ø§Ù„Ù… ÙˆØ«Ø¹Ø§Ø¨ÙŠÙ†) Ù…Ø¹ Ø¹Ù‚ÙˆØ¨Ø§Øª
        const mapData = {
            grid: { cols: COLS, rows: ROWS, serpentine: true },
            cells: [],
            ladders: { "4": 14, "9": 31, "20": 38, "28": 84, "40": 59, "51": 67, "63": 81, "71": 91 },
            snakes: { "17": 7, "54": 34, "62": 19, "64": 60, "87": 24, "93": 73, "95": 75, "99": 78 },
            penaltySquares: { "14": { type: "loseTurn" }, "55": { type: "backSteps", steps: 3 }, "77": { type: "loseTurn" } }
        };

        // Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ù†Ø¸Ø§Ù… Ø¯ÙŠÙˆÙŠ) - Ù…ÙˆØ³Ø¹ Ù‚Ù„ÙŠÙ„Ø§Ù‹
        const questionBank = {
            easy: [
                { q: 'Ù…Ø§ Ù‡Ø¯Ù Ù†Ø¸Ø§Ù… Ø¯ÙŠÙˆÙŠ Ø§Ù„Ø¹Ø´Ø±ÙŠØŸ', options: ['ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª ÙÙ‚Ø·', 'ØªØµÙ†ÙŠÙ Ø§Ù„ÙƒØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø¨Ø±Ù…ÙˆØ² Ø¹Ø¯Ø¯ÙŠØ©', 'ØªØ±ØªÙŠØ¨ Ø§Ù„ÙƒØªØ¨ Ø£Ø¨Ø¬Ø¯ÙŠØ§Ù‹', 'Ø¥Ø­ØµØ§Ø¡ Ø§Ù„ÙƒØªØ¨ Ø¨Ø§Ù„Ù…ÙƒØªØ¨Ø©'], a: 1 },
                { q: 'ÙƒÙ… Ø®Ø§Ù†Ø© Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙŠ Ø¯ÙŠÙˆÙŠØŸ', options: ['5', '10', '100', '3'], a: 1 },
                { q: 'Ø£ÙŠ Ù†Ø·Ø§Ù‚ ÙŠØ®Øµ Ø§Ù„Ø£Ø¯Ø¨ ÙÙŠ Ø¯ÙŠÙˆÙŠØŸ', options: ['700', '800', '900', '600'], a: 1 },
                { q: 'Ø£ÙŠ Ù†Ø·Ø§Ù‚ ÙŠØ®Øµ Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©ØŸ', options: ['300', '200', '100', '400'], a: 0 },
                { q: 'Ù…Ø§ Ø±Ù‚Ù… Ø¯ÙŠÙˆÙŠ Ù„Ù„ÙÙ„Ø³ÙØ©ØŸ', options: ['100', '200', '300', '400'], a: 0 },
                { q: 'Ø£ÙŠ Ù†Ø·Ø§Ù‚ ÙŠØ®Øµ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§ØŸ', options: ['900', '800', '700', '600'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 600 ÙÙŠ Ø¯ÙŠÙˆÙŠ ÙŠØºØ·ÙŠØŸ', options: ['Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠØ©', 'Ø§Ù„ÙÙ†ÙˆÙ†', 'Ø§Ù„Ø£Ø¯Ø¨', 'Ø§Ù„ØªØ§Ø±ÙŠØ®'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 800 ÙŠØºØ·ÙŠØŸ', options: ['Ø§Ù„Ø£Ø¯Ø¨', 'Ø§Ù„Ø¹Ù„ÙˆÙ…', 'Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§', 'Ø§Ù„ÙÙ„Ø³ÙØ©'], a: 0 },
                { q: 'Ø¯ÙŠÙˆÙŠ ÙŠØ³ØªØ®Ø¯Ù…ØŸ', options: ['Ø±Ù…ÙˆØ² Ø±Ù‚Ù…ÙŠØ©', 'Ø­Ø±ÙˆÙ', 'ØµÙˆØ±', 'Ø£Ù„ÙˆØ§Ù†'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 000 ÙŠØºØ·ÙŠØŸ', options: ['Ø§Ù„Ù…Ø¹Ø§Ø±Ù Ø§Ù„Ø¹Ø§Ù…Ø©', 'Ø§Ù„ÙÙ„Ø³ÙØ©', 'Ø§Ù„Ø¯ÙŠÙ†', 'Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª'], a: 0 }
            ],
            medium: [
                { q: 'Ø£ÙŠ Ù†Ø·Ø§Ù‚ Ù„Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠØ© ÙˆØ§Ù„Ù‡Ù†Ø¯Ø³Ø©ØŸ', options: ['600-699', '500-599', '700-799', '800-899'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 520 ÙŠØ±Ù…Ø² Ø¥Ù„Ù‰ØŸ', options: ['Ø§Ù„ÙÙ„Ùƒ', 'Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡', 'Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡', 'Ø§Ù„Ø£Ø­ÙŠØ§Ø¡'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 330 ÙŠØºØ·ÙŠØŸ', options: ['Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯', 'Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†', 'Ø§Ù„ØªØ±Ø¨ÙŠØ©', 'Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 940 ÙŠØºØ·ÙŠØŸ', options: ['ØªØ§Ø±ÙŠØ® Ø£ÙˆØ±ÙˆØ¨Ø§', 'ØªØ§Ø±ÙŠØ® Ø¢Ø³ÙŠØ§', 'ØªØ§Ø±ÙŠØ® Ø¥ÙØ±ÙŠÙ‚ÙŠØ§', 'ØªØ§Ø±ÙŠØ® Ø£Ù…Ø±ÙŠÙƒØ§'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 370 ÙŠØºØ·ÙŠØŸ', options: ['Ø§Ù„ØªØ±Ø¨ÙŠØ©', 'Ø§Ù„ÙÙ„Ø³ÙØ©', 'Ø§Ù„Ø¯ÙŠÙ†', 'Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 641.5 ÙŠØºØ·ÙŠØŸ', options: ['ÙƒØªØ¨ Ø§Ù„Ø·Ø¨Ø®', 'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©', 'Ø§Ù„Ø·Ø¨', 'Ø§Ù„Ø²Ø±Ø§Ø¹Ø©'], a: 0 },
                { q: 'Ø£ÙŠÙ† ØªÙˆØ¶Ø¹ ÙƒØªØ¨ Ø¹Ù† Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³ØŸ', options: ['150', '170', '190', '130'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 910 ÙŠØºØ·ÙŠØŸ', options: ['Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„Ø³ÙØ±', 'Ø§Ù„Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 530 ÙŠØºØ·ÙŠØŸ', options: ['Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡', 'Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡', 'Ø§Ù„ÙÙ„Ùƒ', 'Ø§Ù„Ø£Ø­ÙŠØ§Ø¡'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 340 ÙŠØºØ·ÙŠØŸ', options: ['Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†', 'Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯', 'Ø§Ù„Ø³ÙŠØ§Ø³Ø©', 'Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹'], a: 0 }
            ],
            hard: [
                { q: 'Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† 641 Ùˆ 642ØŸ', options: ['641 Ù„Ù„Ø·Ù‡ÙŠØŒ 642 Ù„Ù„Ù…Ù†Ø³ÙˆØ¬Ø§Øª', '641 Ù„Ù„Ø±ÙŠØ§Ø¶Ø©ØŒ 642 Ù„Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰', 'Ù„Ø§ ÙØ±Ù‚', '641 Ù„Ù„ØªØ§Ø±ÙŠØ®ØŒ 642 Ù„Ù„Ø¬ØºØ±Ø§ÙÙŠØ§'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 398 ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ØŸ', options: ['Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ±', 'Ø§Ù„ÙÙ„Ø³ÙØ©', 'Ø§Ù„Ø¯ÙŠÙ†', 'Ø§Ù„Ù„ØºØ©'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 371.9 ÙŠØºØ·ÙŠØŸ', options: ['Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø®Ø§Øµ', 'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©', 'Ø§Ù„Ø·Ø¨', 'Ø§Ù„ÙÙ†ÙˆÙ†'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 333 ÙŠØºØ·ÙŠØŸ', options: ['Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ', 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„Ø·Ø¨'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 597.7 ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ØŸ', options: ['Ø§Ù„Ø£Ø³Ù…Ø§Ùƒ', 'Ø§Ù„Ø·ÙŠÙˆØ±', 'Ø§Ù„Ø«Ø¯ÙŠÙŠØ§Øª', 'Ø§Ù„Ø²ÙˆØ§Ø­Ù'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 941 ÙŠØ®ØµØŸ', options: ['ØªØ§Ø±ÙŠØ® Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠØ§', 'ØªØ§Ø±ÙŠØ® ÙØ±Ù†Ø³Ø§', 'ØªØ§Ø±ÙŠØ® Ø£Ù„Ù…Ø§Ù†ÙŠØ§', 'ØªØ§Ø±ÙŠØ® Ø¥ÙŠØ·Ø§Ù„ÙŠØ§'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 030 ÙŠØºØ·ÙŠØŸ', options: ['Ø§Ù„Ù…ÙˆØ³ÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©', 'Ø§Ù„ÙÙ„Ø³ÙØ©', 'Ø§Ù„Ø¯ÙŠÙ†', 'Ø§Ù„Ù„ØºØ©'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 362 ÙŠØºØ·ÙŠØŸ', options: ['Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ', 'Ø§Ù„Ø·Ø¨', 'Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯', 'Ø§Ù„ÙÙ†ÙˆÙ†'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 808 ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ØŸ', options: ['Ø§Ù„Ø®Ø·Ø§Ø¨Ø©', 'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„Ø·Ø¨'], a: 0 },
                { q: 'Ø§Ù„Ø±Ù‚Ù… 150.2 ÙÙŠ Ø¯ÙŠÙˆÙŠØŸ', options: ['Ù†Ø¸Ø±ÙŠØ§Øª Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³', 'Ø§Ù„Ø¨ØµØ±ÙŠØ§Øª', 'Ø§Ù„Ø·Ø¨', 'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©'], a: 0 }
            ]
        };

        // Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        let position = 1;
        let currentDice = 0;
        let questionTimer = null;
        let qTimeRemaining = QUESTION_TIME;
        let gameOver = false;
        let skipTurn = false; // Ù„Ø¹Ù‚ÙˆØ¨Ø© ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø¯ÙˆØ±
        let recentQuestions = { easy: [], medium: [], hard: [] }; // Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„ÙˆØ­Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
        function initGame() {
            if (boardImage.complete && boardImage.naturalWidth !== 0) {
                resizeCanvasAndRedraw();
            } else {
                boardImage.addEventListener('load', () => {
                    resizeCanvasAndRedraw();
                });
            }
        }

        function resizeCanvasAndRedraw() {
            overlayCanvas.width = boardImage.clientWidth;
            overlayCanvas.height = boardImage.clientHeight;
            generateCells();
            drawOverlay(); // Ø§Ù„Ø¢Ù† Ù„Ø§ ØªØ±Ø³Ù… Ø´ÙŠØ¦Ø§Ù‹
            updatePositionUI();
            log('ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„ÙˆØ­Ø©');
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø­Ø¬Ù… Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù†Ø³Ø¨ Ù…Ø¦ÙˆÙŠØ©)
        function generateCells() {
            mapData.cells = [];
            const w = overlayCanvas.width;
            const h = overlayCanvas.height;
            for (let i = 0; i < N; i++) {
                const idx = i + 1;
                const rowFromBottom = Math.floor(i / COLS); // 0 Ù„Ù„Ø£Ø³ÙÙ„ØŒ 1 Ù„Ù„Ø£Ø¹Ù„Ù‰ØŒ ...
                const row = ROWS - 1 - rowFromBottom; // 0 Ù„Ù„Ø£Ø¹Ù„Ù‰ØŸ Ù„ÙƒÙ†Ù†Ø§ Ù†Ø­ØªØ§Ø¬ Ø§Ù„Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ØŒ Ù„Ø°Ø§ Ù†Ø³ØªØ®Ø¯Ù… rowFromBottom Ù„Ù„Ø§ØªØ¬Ø§Ù‡
                let col = i % COLS;
                // Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…ØªØ¹Ø±Ø¬: Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø²ÙˆØ¬ÙŠØ© Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† (col Ø¹Ø§Ø¯ÙŠ)ØŒ Ø§Ù„ÙØ±Ø¯ÙŠØ© Ù…Ø¹ÙƒÙˆØ³Ø©
                const isReverse = mapData.grid.serpentine && ((rowFromBottom % 2) === 1);
                if (isReverse) col = COLS - 1 - col;
                // left Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± (Ù„Ø£Ù† dir rtl Ø³Ù†Ø¹ÙƒØ³ØŸ Ù„ÙƒÙ† canvas Ø¨Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…Ø·Ù„Ù‚Ø©ØŒ left Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø±)
                const leftPct = ((col + 0.5) / COLS) * 100;
                // top Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ (rowFromBottom: 0 Ù‡Ùˆ Ø§Ù„Ø£Ø³ÙÙ„ØŒ Ù„Ø°Ø§ Ù†Ø­ØªØ§Ø¬ ØªØ­ÙˆÙŠÙ„Ù‡ Ø¥Ù„Ù‰ top)
                // Ø¨Ù…Ø§ Ø£Ù† rowFromBottom = 0 ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ØŒ top ÙŠÙƒÙˆÙ† 100% - (0.5/ROWS)*100 ØŸ
                // Ø§Ù„Ø£Ø³Ù‡Ù„: row = ROWS - 1 - rowFromBottom (Ø§Ù„Ø¢Ù† row=0 Ù„Ù„Ø£Ø¹Ù„Ù‰)
                // Ø«Ù… topPct = ((row + 0.5) / ROWS) * 100
                const topRow = ROWS - 1 - rowFromBottom; // 9 Ù„Ù„Ø£Ø¹Ù„Ù‰, 0 Ù„Ù„Ø£Ø³ÙÙ„
                const topPct = ((topRow + 0.5) / ROWS) * 100;
                mapData.cells.push({ index: idx, left: leftPct + '%', top: topPct + '%' });
            }
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ù…: Ø§Ù„Ø¢Ù† ÙØ§Ø±ØºØ© ØªÙ…Ø§Ù…Ø§Ù‹ Ù„Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ø±Ø³ÙˆÙ…Ø§Øª
        function drawOverlay() {
            const ctx = overlayCanvas.getContext('2d');
            ctx.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);
            // Ù„Ø§ Ù†Ø±Ø³Ù… Ø£ÙŠ Ø´ÙŠØ¡ â€“ Ù†Ø¹ØªÙ…Ø¯ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©
        }

        // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©
        function updatePositionUI() {
            posEl.textContent = position;
            const p = mapData.cells.find(x => x.index === position);
            if (p) {
                playerEl.style.left = p.left;
                playerEl.style.top = p.top;
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„
        function log(text) {
            const d = document.createElement('div');
            d.textContent = `${new Date().toLocaleTimeString('ar-EG')} â€” ${text}`;
            logEl.prepend(d);
            if (logEl.children.length > 6) logEl.removeChild(logEl.lastChild);
            stateEl.textContent = text.split(' ')[0] || 'Ø¬Ø§Ø±Ù';
        }

        // ØªØ£Ø®ÙŠØ± Ù„Ù„Ø­Ø±ÙƒØ©
        function wait(ms) { return new Promise(res => setTimeout(res, ms)); }

        // Ø­Ø±ÙƒØ© ØªØ¯Ø±ÙŠØ¬ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù
        async function movePlayerTo(target) {
            if (target < 1) target = 1;
            if (target > N) target = N;
            const step = target > position ? 1 : -1;
            while (position !== target) {
                position += step;
                updatePositionUI();
                await wait(280); // Ø³Ø±Ø¹Ø© Ø­Ø±ÙƒØ© Ù…Ù†Ø§Ø³Ø¨Ø©
            }
            await handleSpecialSquare(); // ØªÙØ¹ÙŠÙ„ Ø£ÙŠ Ù…Ø±Ø¨Ø¹ Ø®Ø§Øµ Ø¨Ø¹Ø¯ Ø§Ù„ÙˆØµÙˆÙ„
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø®Ø§ØµØ© (Ø³Ù„Ù…ØŒ Ø«Ø¹Ø¨Ø§Ù†ØŒ Ø¹Ù‚ÙˆØ¨Ø©)
        async function handleSpecialSquare() {
            if (mapData.ladders[position]) {
                const dest = mapData.ladders[position];
                log(`Ø³Ù„Ù…! ØµØ¹ÙˆØ¯ Ø¥Ù„Ù‰ ${dest}`);
                await wait(200);
                await movePlayerTo(dest);
                return;
            }
            if (mapData.snakes[position]) {
                const dest = mapData.snakes[position];
                log(`Ø«Ø¹Ø¨Ø§Ù†! Ù‡Ø¨ÙˆØ· Ø¥Ù„Ù‰ ${dest}`);
                await wait(200);
                await movePlayerTo(dest);
                return;
            }
            if (mapData.penaltySquares[position]) {
                const p = mapData.penaltySquares[position];
                if (p.type === 'loseTurn') {
                    log('Ù…Ø±Ø¨Ø¹ Ø¹Ù‚Ø§Ø¨: Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ù‚Ø§Ø¯Ù…');
                    skipTurn = true;
                } else if (p.type === 'backSteps') {
                    const newPos = Math.max(1, position - p.steps);
                    log(`Ù…Ø±Ø¨Ø¹ Ø¹Ù‚Ø§Ø¨: Ø§Ù„Ø±Ø¬ÙˆØ¹ ${p.steps} Ø®Ø·ÙˆØ§Øª Ø¥Ù„Ù‰ ${newPos}`);
                    await movePlayerTo(newPos);
                }
            }
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø³Ø¤Ø§Ù„ ØºÙŠØ± Ù…ØªÙƒØ±Ø± Ø­Ø³Ø¨ Ø§Ù„ØµØ¹ÙˆØ¨Ø©
        function getRandomQuestion(difficulty) {
            const arr = questionBank[difficulty];
            if (!arr.length) return null;
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªÙŠ Ù„Ù… ØªØ³ØªØ®Ø¯Ù… Ù…Ø¤Ø®Ø±Ù‹Ø§ (Ø¢Ø®Ø± 3)
            const recent = recentQuestions[difficulty] || [];
            const available = arr.filter((_, idx) => !recent.includes(idx));
            let selectedIdx;
            if (available.length === 0) {
                // Ø¥Ø°Ø§ ØªÙƒØ±Ø±Øª ÙƒÙ„Ù‡Ø§ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø£ÙŠ Ø³Ø¤Ø§Ù„ Ùˆ Ù†ÙØ¹ÙŠØ¯ Ø¶Ø¨Ø· Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                selectedIdx = Math.floor(Math.random() * arr.length);
                recentQuestions[difficulty] = [selectedIdx];
            } else {
                const availableIndices = available.map(q => arr.indexOf(q));
                selectedIdx = availableIndices[Math.floor(Math.random() * availableIndices.length)];
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
                recentQuestions[difficulty].push(selectedIdx);
                if (recentQuestions[difficulty].length > 3) recentQuestions[difficulty].shift();
            }
            return { q: arr[selectedIdx], difficulty };
        }

        function pickQuestionByDice(d) {
            let bucket = 'easy';
            if (d <= 2) bucket = 'easy';
            else if (d <= 4) bucket = 'medium';
            else bucket = 'hard';
            return getRandomQuestion(bucket);
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„
        function presentQuestion(dice) {
            const pick = pickQuestionByDice(dice);
            if (!pick) {
                log('Ø®Ø·Ø£ ÙÙŠ Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©');
                return;
            }
            const diffText = { easy: 'Ø³Ù‡Ù„', medium: 'Ù…ØªÙˆØ³Ø·', hard: 'ØµØ¹Ø¨' }[pick.difficulty];
            questionText.textContent = `[${diffText}] ${pick.q.q}`;
            answersEl.innerHTML = '';
            pick.q.options.forEach((opt, idx) => {
                const b = document.createElement('button');
                b.className = 'snl-answer-btn';
                b.textContent = opt;
                b.onclick = () => answerSelected(idx, pick.q.a, dice);
                answersEl.appendChild(b);
            });
            questionPanel.hidden = false;
            startQuestionTimer(dice);
        }

        function startQuestionTimer(dice) {
            qTimeRemaining = QUESTION_TIME;
            qTimerEl.textContent = qTimeRemaining;
            if (questionTimer) clearInterval(questionTimer);
            questionTimer = setInterval(() => {
                qTimeRemaining--;
                qTimerEl.textContent = qTimeRemaining;
                if (qTimeRemaining <= 0) {
                    clearInterval(questionTimer);
                    questionTimer = null;
                    questionPanel.hidden = true;
                    log('âŒ› Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©');
                    onWrongAnswer(dice);
                }
            }, 1000);
        }

        function answerSelected(idx, correctIdx, dice) {
            if (questionTimer) { clearInterval(questionTimer); questionTimer = null; }
            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
            document.querySelectorAll('.snl-answer-btn').forEach(btn => btn.disabled = true);
            if (idx === correctIdx) {
                log('âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©');
                onCorrectAnswer(dice);
            } else {
                log('âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©');
                onWrongAnswer(dice);
            }
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„ÙˆØ­Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
            setTimeout(() => { questionPanel.hidden = true; }, 1000);
        }

        async function onCorrectAnswer(dice) {
            const target = Math.min(N, position + dice);
            await movePlayerTo(target);
            if (position === N) {
                gameOver = true;
                rollBtn.disabled = true;
                log('ğŸ† Ø§Ù†ØªØµØ±Øª! ÙˆØµÙ„Øª Ù„Ù„Ù†Ù‡Ø§ÙŠØ©!');
            }
        }

        async function onWrongAnswer(dice) {
            // Ø§Ù„ØªØ­Ø±Ùƒ Ù„Ù„Ø®Ù„Ù Ø¨Ø¹Ø¯Ø¯ Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù†Ø±Ø¯
            const target = Math.max(1, position - dice);
            await movePlayerTo(target);
            if (position === N) { // Ø§Ø­ØªÙ…Ø§Ù„ ÙŠØµÙ„ Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©ØŸ Ù„Ø§ØŒ Ù„ÙƒÙ† Ù„Ùˆ ÙˆØµÙ„ 100 Ø¨Ø§Ù„Ø®Ø·Ø£
                gameOver = true;
                rollBtn.disabled = true;
                log('ğŸ† Ø§Ù†ØªØµØ±Øª? Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ø§ ÙˆØµÙ„Øª Ù„Ù„Ù†Ù‡Ø§ÙŠØ©!');
            }
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
        function resetGame() {
            gameOver = false;
            skipTurn = false;
            position = 1;
            currentDice = 0;
            diceResult.textContent = '-';
            updatePositionUI();
            log('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©');
            rollBtn.disabled = false;
            questionPanel.hidden = true;
            if (questionTimer) clearInterval(questionTimer);
            questionTimer = null;
            // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ù„ÙˆØ­Ø©
            if (boardImage.complete) {
                resizeCanvasAndRedraw();
            }
        }

        // Ø­Ø¯Ø« Ø§Ù„Ù†Ø±Ø¯
        rollBtn.addEventListener('click', () => {
            if (gameOver) {
                log('Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù†ØªÙ‡ØªØŒ Ø£Ø¹Ø¯ Ø§Ù„Ø¨Ø¯Ø¡');
                return;
            }
            if (!questionPanel.hidden) return;
            if (skipTurn) {
                log('âš¡ Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ± (Ù…Ø±Ø¨Ø¹ Ø¹Ù‚Ø§Ø¨)');
                skipTurn = false;
                return;
            }
            currentDice = Math.floor(Math.random() * 6) + 1;
            diceResult.textContent = currentDice;
            log(`ğŸ² Ø±Ù…ÙŠØ© Ø§Ù„Ù†Ø±Ø¯: ${currentDice}`);
            presentQuestion(currentDice);
        });

        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        resetBtn.addEventListener('click', resetGame);

        // Ø§Ù„ØªÙƒÙŠÙ Ù…Ø¹ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
        window.addEventListener('resize', () => {
            if (boardImage.complete) {
                resizeCanvasAndRedraw();
            }
        });

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        initGame();

        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙˆØ±Ø© Ù…Ø­Ù…Ù„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
        if (boardImage.complete && boardImage.naturalWidth !== 0) {
            resizeCanvasAndRedraw();
        }
    </script>
</body>

</html>